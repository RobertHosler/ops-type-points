<div #container class="container">
  <div *ngIf="false" class="img-right img-heading">
    <img src="/assets/images/database.png" />
  </div>
  <div *ngIf="!searchInitiated" class="search-top">
    <h1>
      <span class="search-heading">Search the </span
      ><span class="sp-branding">Database</span>
    </h1>
    <div>
      <p class="lead">
        <strong>{{ recordCount }}</strong> people typed in the
        <strong>Objective Personality System</strong>,
        <strong>Enneagram</strong>, and <strong>Socionics</strong>.
      </p>
    </div>
    <div class="d-none d-sm-flex my-2" *ngIf="false">
      <app-type-indicator [option]="1"></app-type-indicator>
      <div class="mx-3">
        <app-type-indicator
          [option]="1"
          type="MF-Fe/Ni-BP/C(S)"
        ></app-type-indicator>
      </div>
      <div class="mx-3">
        <app-type-indicator
          [option]="1"
          type="FM-Fi/Se-CS/B(P)"
        ></app-type-indicator>
      </div>
      <div class="mx-3">
        <app-type-indicator
          [option]="1"
          type="FF-Ti/Ni-SB/P(C)"
        ></app-type-indicator>
      </div>
    </div>
  </div>
  <div class="clear-right"></div>
  <div class="my-3">
    <div class="form-group">
      <!-- <label for="name" class="name-label">Search by Name or Type:</label> -->
      <div class="input-group">
        <input
          #nameInput
          id="name"
          type="text"
          class="form-control border-primary"
          minlength="2"
          required
          autocomplete="off" 
          [placeholder]="placeholderText"
          (keyup)="searchAll()"
          [(ngModel)]="textString"
          name="name"
        />
        <div class="input-group-append">
          <button
            class="btn btn-outline-primary"
            (click)="textString = ''; nameInput.focus(); searchAll()"
          >
            Clear
          </button>
        </div>
      </div>
      <div class="help small mb-3" *ngIf="false">
        Searches for the text within the name and types field of the person
        record. Examples:
        <a [routerLink]="['/search']" [queryParams]="{ text: 'john cena' }"
          >john cena</a
        >,
        <a [routerLink]="['/search']" [queryParams]="{ text: 'sp/so - 6w7' }"
          >sp/so - 6w7</a
        >,
        <a [routerLink]="['/search']" [queryParams]="{ text: 'ff-ti/se' }"
          >ff-ti/se</a
        >
      </div>
    </div>
    <div *ngIf="false">
      <div class="mb-3">
        <span class="search-type-label">Additional Search Options</span>
        <div>
          <button
            *ngFor="let st of searchToggles"
            class="btn btn-gray mr-2"
            (click)="toggleSearchOptions(st.name)"
            [ngClass]="{ active: st.active }"
          >
            {{ st.name }}
          </button>
        </div>
      </div>
      <div [ngClass]="{ 'd-none': !enneaToggle.active }">
        <ng-component *ngTemplateOutlet="ennea"></ng-component>
      </div>
      <div [ngClass]="{ 'd-none': !opsToggle.active }">
        <ng-component *ngTemplateOutlet="ops"></ng-component>
      </div>
    </div>
    <div class="button-wrapper" *ngIf="searchInitiated">
      <div class="d-inline-block">
        <div class="small">Sort:</div>
        <div class="btn-group">
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: sortBy === 'name' }"
            (click)="resort('name')"
          >
            Name
          </button>
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: sortBy === 'ops' }"
            (click)="resort('ops')"
          >
            OPS
          </button>
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: sortBy === 'ennea' }"
            (click)="resort('ennea')"
          >
            Ennea
          </button>
        </div>
      </div>
      <div class="d-inline-block">
        <div class="small">Color:</div>
        <div class="btn-group">
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: grayscale }"
            (click)="grayscale = !grayscale"
          >
            Gray
          </button>
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: !grayscale }"
            (click)="grayscale = !grayscale"
          >
            Default
          </button>
        </div>
      </div>
      <div class="d-inline-block">
        <div class="small">Display:</div>
        <div class="btn-group">
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: cards }"
            (click)="cards = !cards"
          >
            Cards
          </button>
          <button
            class="btn btn-gray btn-sm"
            [ngClass]="{ active: !cards }"
            (click)="cards = !cards"
          >
            Default
          </button>
        </div>
      </div>
      <div class="d-inline-block">
        <button
          class="btn btn-gray btn-sm"
          [ngClass]="{ active: showHelp }"
          (click)="showHelp = !showHelp"
        >
          Help
        </button>
      </div>
    </div>
    <div *ngIf="showHelp" class="mt-2">
      <ng-component *ngTemplateOutlet="tips"></ng-component>
    </div>
    <div class="mt-2" *ngIf="searches.size > 0">
      <div>Previous Searches</div>
      <div class="previous-search-wrapper">
        <span
          *ngFor="let previousSearch of searches | keyvalue"
          class="previous-search"
        >
          <a
            [routerLink]="['/search']"
            [queryParams]="{ text: previousSearch.key }"
            >{{ previousSearch.value.term }} ({{
              previousSearch.value.count
            }})</a
          >
          <button (click)="searches.delete(previousSearch.key)">X</button>
        </span>
        <button
          *ngIf="searches.size > 4"
          (click)="searches.clear()"
          class="previous-search previous-search-clear"
        >
          Clear All
        </button>
      </div>
    </div>
  </div>
  <p *ngIf="displayedRecords && displayedRecords.length > 0" class="text-info">
    Search found {{ displayedRecords.length }} results.
  </p>
</div>
<div class="record-wrapper">
  <div *ngIf="searchInitiated" class="container-fluid records-bg" #recordList>
    <app-type-record-list
      [typeRecords]="displayedRecords"
      [loading]="searchLoading"
      [linkToAnalyzer]="true"
      [grayscale]="grayscale"
      [cards]="cards"
    ></app-type-record-list>
  </div>
</div>

<ng-template #ops>
  <div class="search-coins mb-5">
    <div class="row">
      <div class="col-md-4">
        <div *ngIf="options" class="coin-groups">
          <div *ngFor="let option of optionValues">
            <div class="coin-label coin-label-sm" *ngIf="false">
              <a
                [href]="option.coin.infoLink"
                target="_blank"
                *ngIf="option.coin.infoLink"
              >
                {{ option.coin.name }}
              </a>
              <span *ngIf="!option.coin.infoLink">
                {{ option.coin.name }}
              </span>
            </div>
            <div class="btn-group" btnRadioGroup [(ngModel)]="option.val">
              <ng-container
                *ngIf="option.coin.sides.length === 2; else other_content"
              >
                <label
                  class="btn btn-side"
                  [btnRadio]="option.coin.sides[0].val"
                >
                  {{ option.coin.sides[0].name }}
                </label>
                <label class="btn btn-middle" [btnRadio]="''"> / </label>
                <label
                  class="btn btn-side"
                  [btnRadio]="option.coin.sides[1].val"
                >
                  {{ option.coin.sides[1].name }}
                </label>
              </ng-container>
              <ng-template #other_content>
                <label
                  class="btn"
                  [btnRadio]="side.val"
                  *ngFor="let side of option.coin.sides"
                >
                  {{ side.name }}
                </label>
                <label class="btn btn-unset" [btnRadio]="''"> Clear </label>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 d-md-none">
        <hr />
      </div>
      <div class="col-md-8">
        <div *ngFor="let cluster of clusters">
          <span class="coin-label d-none">{{ cluster.name }}</span>
          <div class="coin-groups">
            <div class="btn-group">
              <label
                class="btn"
                *ngFor="let funct of cluster.cluster"
                [ngClass]="{ active: isCoins(funct.coins) }"
                (click)="setCoins(funct.coins)"
              >
                {{ funct.label }}
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #ennea>
  <div class="search-coins search-enneagram mb-5">
    <div class="search-ewrapper mb-3">
      <div class="search-etype mr-3">
        <label class="type-label">Type</label>
        <span *ngFor="let eType of eTypes; let i = index">
          <button
            class="btn btn-gray mx-1 my-1"
            [ngClass]="{ active: activeEType === eType }"
            (click)="toggleEType(eType)"
          >
            {{ eType.name }}
          </button>
          <br *ngIf="(i + 1) % 3 === 0"
        /></span>
      </div>
      <div class="search-wing mr-3">
        <label class="type-label">Wing</label>
        <div *ngIf="activeEType">
          <button
            *ngFor="let wing of activeEType.wings"
            class="btn btn-gray mx-1"
            [ngClass]="{ active: activeWing === wing }"
            (click)="
              activeWing === wing ? (activeWing = null) : (activeWing = wing)
            "
          >
            {{ wing }}
          </button>
        </div>
        <div *ngIf="!activeEType">
          <button class="btn btn-gray mx-1" *ngFor="let x of [1, 2]">?</button>
        </div>
      </div>
      <div class="search-instinct mr-3">
        <label class="type-label">Instinct</label>
        <button
          *ngFor="let instinct of instincts"
          class="btn btn-gray mx-1"
          [ngClass]="{ active: activeInstinct === instinct }"
          (click)="toggleInstinct(instinct)"
        >
          {{ instinct.name }}
        </button>
      </div>
      <div class="search-instinct2">
        <label class="type-label">Second Instinct</label>
        <div *ngIf="activeInstinct">
          <button
            *ngFor="let second of activeInstinct.secondary"
            class="btn btn-gray mx-1"
            [ngClass]="{ active: activeInstinct2 === second }"
            (click)="
              activeInstinct2 === second
                ? (activeInstinct2 = null)
                : (activeInstinct2 = second)
            "
          >
            {{ second }}
          </button>
        </div>
        <div *ngIf="!activeInstinct">
          <button class="btn btn-gray mx-1" *ngFor="let x of [1, 2]">?</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #tips>
  <ul class="search-tips">
    <li>
      <a [routerLink]="['/search']" [queryParams]="{ text: 'Kardashian' }"
        >Looking for a specific person? Search by name, Ex: "Kardashian"</a
      >
    </li>
    <li>
      <a [routerLink]="['/search']" [queryParams]="{ text: 'mm exxj fe' }">
        Want to see those of a similar type? Search by parts. Ex: "mm exxj
        fe"</a
      >
    </li>
    <li>
      <a [routerLink]="['/search']" [queryParams]="{ text: 'ennea' }">
        Only want to see those with an Enneagram type? Add "Ennea" or
        "Enneagram" to your search.</a
      >
    </li>
    <li>
      Just try some things out! If you find a keyword isn't working as you might
      expect,
      <a [href]="appLinks.contact" target="_blank">let me know!</a>
    </li>
  </ul>
</ng-template>
